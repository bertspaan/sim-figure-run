<!DOCTYPE html>
<html>
<head>
	<title>SIM Figure Run</title>
  <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="style.css" />
  <link href='http://fonts.googleapis.com/css?family=Gudea:400,700,400italic' rel='stylesheet' type='text/css'>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js?2"></script>
</head>
<body>
  <div id="map">
  </div>
  <div id="box">
    <h1>SIM Figure Run</h1>
    <h2>blablabla lekker rondjes rennen</h2>
    <table id="bar">
      <tr />
    </table>
    <span id="last"></span>
  </div>
	<script>
  
    var colors = ["rgb(255, 153, 0)", "#00ffff"],
        map = L.map('map');
    
    //http://127.0.0.1:20008/tile/sim-figure-run/14/8414/5386.png?updated=1390253785000&metatile=1&scale=1
    
    var waag = '<a href="http://www.waag.org" title="Institute for art, science &amp; technology">Waag Society <img id="waag-mini" src="waag-mini.png" /></a>';		
    
    var tileLayer = L.tileLayer("http://otile2.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png", {
		//var tileLayer = L.tileLayer("http://127.0.0.1:20008/tile/sim-figure-run/{z}/{x}/{y}.png?updated=1391253780000&metatile=1&scale=1", {
      attribution: waag,
			minZoom: 12,
			maxZoom: 16
		}).addTo(map);
    map.setView([52.3674, 4.915], 14);
        
    
    d3.json("routes.json", function(json) {
      var geojson = {
        type: "FeatureCollection",
        features: []          
      };
      
      walked = 0;
      json.forEach(function(route) {
        
        walked += (route.walked > 0) ? 1 : 0;
        
        var geometry = route.coordinates;        
        geometry.coordinates.forEach(function(coordinate) {
          coordinate.reverse();
        });        

        var feature = {
          type: "Feature",
          properties: {
            id: route.routeid,
            date: route.date,
            walked: (route.walked > 0)
          },
          geometry: geometry
        }
        geojson.features.push(feature);          
      });      

      L.geoJson(geojson, {
        style: function(feature) {
          switch (feature.properties.walked) {
            case true:  return {color: colors[0]};
            case false: return {color: colors[1]};
          }
        }
      }).addTo(map);
      
      d3.select("#bar tr").selectAll("td")
          .data([walked, json.length - walked])
          .enter()
        .append("td")
          .attr("width", function(d) { return Math.round(d / json.length * 100) + "%" })
          .attr("title", function(d) { return Math.round(d / json.length * 100) + "%" })
          .attr("class", function(d, i) { return i == 0 ? "walked" : ""; })
          .style("background-color", function(d, i) { return colors[i]; })
          .html(function(d, i) { return d; })
      
    });
    
  </script>
</body>
</html>